<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SoundCloud</title>
<style>
  /* ---------- General ---------- */
  body{
    font-family:Arial,Helvetica,sans-serif;
    background:#0F172A;
    color:#e5e7eb;
    margin:0;
    padding:0;
    min-height:100vh;
    position:relative;
  }
  a{color:#ff7043;text-decoration:underline;}

  /* ---------- Header ---------- */
  h2.title{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:.5rem;
    margin-top:12px;
    font-size:2rem;
    background:linear-gradient(90deg,#ff8a00,#e91e63);
    -webkit-background-clip:text;
    color:transparent;
  }
  p.under-title{
    text-align:center;
    margin:4px 0 6px;
    font-size:1.1rem;
    background:linear-gradient(90deg,#ff8a00,#e91e63);
    -webkit-background-clip:text;
    color:transparent;
  }
  .subheading{
    text-align:center;
    margin-top:5px;
    font-size:1rem;
    background:linear-gradient(90deg,#ff8a00,#e91e63);
    -webkit-background-clip:text;
    color:transparent;
  }

  /* Home button */
  #homeButton{
    display:block;
    text-align:center;
    font-size:2rem;
    cursor:pointer;
    background:none;
    border:none;
    color:white;
    margin:10px 0;
  }

  /* ---------- Global Search Bar (outside playlists) ---------- */
  #searchContainer{
    display:flex;
    justify-content:center;
    margin:15px 0;
    gap:10px;
  }
  #searchInput{
    padding:8px 12px;
    border-radius:5px;
    border:1px solid #ccc;
    width:200px;
  }
  #searchButton{
    padding:8px 15px;
    background:#ff7043;
    color:white;
    border:none;
    border-radius:5px;
    cursor:pointer;
  }
  #searchType{
    padding:8px;
    border-radius:5px;
    border:1px solid #ccc;
  }
  #backButton{
    padding:8px 15px;
    background:#555;
    color:white;
    border:none;
    border-radius:5px;
    cursor:pointer;
    margin-left:10px;
    display:none;
  }

  /* Button container for CLICK ME and DONT CLICK ME */
  #buttonContainer{
    display:flex;
    justify-content:center;
    gap: 10px;
    margin-bottom:15px;
  }
  #allSongsBtn, #dontClickBtn {
    padding:8px 15px;
    background:#ff7043;
    color:white;
    border:none;
    border-radius:5px;
    cursor:pointer;
  }
  #dontClickBtn {
    background: #555;
  }

  /* ---------- Playlist Grid ---------- */
  #playlistContainer{
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  .playlist-card{
    position:relative;
    display:flex;
    flex-direction:column;
    align-items:center;
    margin:15px auto;
    background:#1e293b;
    border-radius:10px;
    padding:15px;
    box-shadow:0 3px 10px rgba(0,0,0,0.5);
    width:90%;
    max-width:400px;
    cursor:pointer;
    transition:transform .2s;
  }
  .playlist-card:hover{transform:scale(1.03);}
  .playlist-card img{
    width:100%;
    border-radius:10px;
    margin-bottom:10px;
  }
  .playlist-card h3,
  .playlist-card p{
    color:#e5e7eb;
  }
  .playlist-card h3{margin:5px 0;}
  .playlist-card p{
    font-size:14px;
    color:#cbd5e1;
  }

  /* ID badge */
  .id-badge{
    position:absolute;
    top:10px;
    left:10px;
    background:#ff7043;
    color:#fff;
    font-size:12px;
    font-weight:bold;
    border-radius:3px;
    padding:2px 5px;
  }

  /* Share / Archive buttons */
  .share-btn,
  .archive-btn{
    position:absolute;
    top:10px;
    background:rgba(0,0,0,0.5);
    color:#fff;
    border:none;
    border-radius:50%;
    width:30px;
    height:30px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    font-size:16px;
  }
  .share-btn{right:10px;}
  .archive-btn{right:50px;}

  /* Open button */
  .open-btn{
    margin-top:10px;
    padding:5px 10px;
    background:#ff7043;
    color:white;
    border:none;
    border-radius:5px;
    cursor:pointer;
  }

  /* ---------- Player Page (no inner search bar) ---------- */
  #playerPage{display:none;text-align:center;}
  #modeContainer{
    text-align:center;
    margin:12px 0;
    display:none;
  }
  #playerContainer{
    margin:20px auto;
    width:90%;
    max-width:700px;
  }
  #controls{
    margin:10px 0;
  }
  #controls button{
    padding:10px 20px;
    margin:0 10px;
    border:none;
    border-radius:5px;
    background:#ff7043;
    color:#fff;
    font-size:16px;
    cursor:pointer;
  }
  #backBtn{
    margin:10px;
    padding:8px 15px;
    border:none;
    border-radius:5px;
    background:#555;
    color:#fff;
    font-size:14px;
    cursor:pointer;
  }

  /* Mode Buttons */
  .mode-btn{
    padding:8px 16px;
    margin:0 5px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    background:#e0e0e0;
    color:#333;
    font-size:.95rem;
  }
  .mode-btn.active{
    background:#ff7043;
    color:#fff;
  }

  /* Modal */
  .modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.6);
    align-items:center;
    justify-content:center;
    z-index:2000;
  }
  .modal-content{
    background:#fff;
    padding:20px;
    border-radius:8px;
    text-align:center;
    max-width:90%;
    box-shadow:0 5px 15px rgba(0,0,0,0.3);
  }
  .modal-content p{margin:10px 0;}

  /* Footer */
  .footer{
    text-align:center;
    padding:10px 0;
    background:#1e293b;
    margin-top:40px;
    font-size:.9rem;
    color:#cbd5e1;
  }

  /* Toast */
  #toast{
    position:fixed;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    background:#333;
    color:#fff;
    padding:10px 20px;
    border-radius:5px;
    display:none;
    opacity:0;
    transition:opacity .5s;
    z-index:1500;
  }

  /* Fullscreen */
  #fullscreenContainer{
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    background:black;
    z-index:10000;
    display:none;
    justify-content:center;
    align-items:center;
  }
  #fullscreenImage{
    max-width:90%;
    max-height:90%;
    object-fit:contain;
  }
  #closeFullscreen{
    position:absolute;
    top:20px;
    right:20px;
    background:rgba(255,255,255,0.2);
    color:white;
    border:none;
    border-radius:50%;
    width:40px;
    height:40px;
    font-size:20px;
    cursor:pointer;
    z-index:10001;
  }
</style>
</head>
<body>

<button id="homeButton">üè†</button>

<h2 class="title">SoundCloud <span>üéß</span></h2>
<p class="under-title">Every song has a place.</p>
<p class="subheading">A home for every song and every soul ‚Äî explore music beyond limits, across languages, moods, and moments.</p>

<!-- Global Search Bar (outside playlists) -->
<div id="searchContainer">
  <input type="text" id="searchInput" placeholder="Search...">
  <select id="searchType">
    <option value="title">Title</option>
    <option value="id">ID</option>
  </select>
  <button id="searchButton">Search</button>
  <button id="backButton">Back</button>
</div>

<!-- Modified button section with CLICK ME and DONT CLICK ME buttons -->
<div id="buttonContainer">
  <button id="allSongsBtn">CLICK ME</button>
  <button id="dontClickBtn">DONT CLICK ME</button>
</div>

<div id="playlistContainer"></div>

<div id="playerPage">
  <button id="backBtn">‚Üê Back</button>

  <div id="modeContainer">
    <button id="randomModeBtn" class="mode-btn">Random</button>
    <button id="orderModeBtn" class="mode-btn">Order</button>
    <button id="repeatModeBtn" class="mode-btn">Repeat</button>
  </div>

  <div id="playerContainer"></div>

  <div id="controls">
    <button id="prevBtn">‚èÆ Previous</button>
    <button id="nextBtn">‚è≠ Next</button>
  </div>
</div>

<div id="feedbackModal" class="modal">
  <div class="modal-content">
    <p>üîê Login or sign up with GitHub to give the feedback.</p>
    <p>üì∫ Or click the video link <a href="https://archive.org/details/panfda" target="_blank">here</a> to know how to give feedback.</p>
    <p>Redirecting in <span id="countdown">5</span> seconds...</p>
  </div>
</div>

<div id="fullscreenContainer">
  <button id="closeFullscreen">‚úñ</button>
  <img id="fullscreenImage" src="" alt="Fullscreen Image">
</div>

<div id="toast"></div>

<footer class="footer">¬© 2026 SoundCloud¬∑ Built with ‚ù§Ô∏è by YAN</footer>

<script src="https://w.soundcloud.com/player/api.js"></script>
<script>
/* ---------- Global Variables ---------- */
const playlistContainer   = document.getElementById('playlistContainer');
const playerPage         = document.getElementById('playerPage');
const playerContainer    = document.getElementById('playerContainer');
const backBtn            = document.getElementById('backBtn');
const prevBtn            = document.getElementById('prevBtn');
const nextBtn            = document.getElementById('nextBtn');
const feedbackModal      = document.getElementById('feedbackModal');
const countdownElm       = document.getElementById('countdown');
const toastElm           = document.getElementById('toast');
const randomModeBtn      = document.getElementById('randomModeBtn');
const orderModeBtn       = document.getElementById('orderModeBtn');
const repeatModeBtn      = document.getElementById('repeatModeBtn');
const modeContainer      = document.getElementById('modeContainer');
const homeButton         = document.getElementById('homeButton');
const fullscreenContainer = document.getElementById('fullscreenContainer');
const fullscreenImage     = document.getElementById('fullscreenImage');
const closeFullscreen     = document.getElementById('closeFullscreen');

const searchInput        = document.getElementById('searchInput');
const searchButton       = document.getElementById('searchButton');
const searchType         = document.getElementById('searchType');
const backButton         = document.getElementById('backButton');
const allSongsBtn        = document.getElementById('allSongsBtn');
const dontClickBtn       = document.getElementById('dontClickBtn');

let widget               = null;          // SoundCloud widget
let currentPlaylist      = [];           // array of tracks
let currentIndex         = 0;
let allPlaylists         = [];           // loaded from data.json
let playMode             = 'order';      // default mode
let filteredPlaylists    = [];           // for global playlist rendering
let autoOpenPlaylistId1  = false;        // auto‚Äëopen ID 1 if no URL param
let playlistLoadedReady  = false;        // set when widget metadata is ready
let userInteracted       = false;        // for mobile autoplay permission

const SHARE_REDIRECT_BASE =
  'https://yan-1-related-1.github.io/yan-1-website-shared-links-redirecting/songs-content-page-shared-links-redirecting.html?playlist_id=';

// detect user interaction (mobile autoplay permission)
document.addEventListener('click', () => {
  userInteracted = true;
}, { once: true });

document.addEventListener('touchstart', () => {
  userInteracted = true;
}, { once: true });

/* ---------- Helper Functions ---------- */
function normalizeText(str){
  if (!str) return '';
  return str
    .toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g,'')
    .replace(/[^a-z0-9\s]/g,'')
    .replace(/\s+/g,' ')
    .trim();
}
function showToast(msg){
  toastElm.textContent = msg;
  toastElm.style.display = 'block';
  toastElm.style.opacity = '1';
  setTimeout(()=>{
    toastElm.style.opacity = '0';
    setTimeout(()=>toastElm.style.display='none',500);
  },3000);
}
function copyToClipboard(text){
  if (navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(text)
      .then(()=>showToast('Link copied to clipboard!'))
      .catch(()=>showToast('Failed to copy link.'));
  }else{
    const ta=document.createElement('textarea');
    ta.value=text;
    ta.style.position='fixed';
    document.body.appendChild(ta);
    ta.focus();ta.select();
    try{
      document.execCommand('copy');
      showToast('Link copied to clipboard!');
    }catch(e){showToast('Failed to copy link.');}
    document.body.removeChild(ta);
  }
}
function sharePlaylist(pl){
  const link = SHARE_REDIRECT_BASE + encodeURIComponent(pl.id);
  if (navigator.share){
    navigator.share({title:pl.title,url:link}).catch(()=>{});
  }else copyToClipboard(link);
}
function setPlayMode(mode){
  playMode = mode;
  randomModeBtn.classList.toggle('active',mode==='random');
  orderModeBtn.classList.toggle('active',mode==='order');
  repeatModeBtn.classList.toggle('active',mode==='repeat');
}
function convertToEmbedImageUrl(detailsUrl){
  const parts = detailsUrl.split('/details/');
  if (parts.length<2) return detailsUrl;
  const identifier = parts[1].split('?')[0].split('#')[0];
  return `https://archive.org/services/img/${identifier}`;
}

/* ---------- Global Playlist Search (outside player) ---------- */
function performSearch(){
  const term = searchInput.value.trim().toLowerCase();
  const by   = searchType.value;
  if (!term){
    filteredPlaylists = [...allPlaylists];
  }else if (by==='title'){
    filteredPlaylists = allPlaylists.filter(p=>p.title.toLowerCase().includes(term));
  }else{
    filteredPlaylists = allPlaylists.filter(p=>String(p.id).includes(term));
  }
  backButton.style.display='inline-block';
  renderPlaylists();
}
function resetSearch(){
  searchInput.value='';
  filteredPlaylists = [...allPlaylists];
  backButton.style.display='none';
  renderPlaylists();
}

/* ---------- UI Rendering ---------- */
function renderPlaylists(){
  playlistContainer.innerHTML='';
  if (filteredPlaylists.length===0){
    playlistContainer.innerHTML='<p style="color:#e5e7eb;text-align:center;">No playlists found.</p>';
    return;
  }
  filteredPlaylists.forEach(pl=>{
    const card=document.createElement('div');
    card.className='playlist-card';
    card.innerHTML=`
      <span class="id-badge">ID: ${pl.id}</span>
      <button class="share-btn" title="Share">üîó</button>
      <button class="archive-btn" title="GameVault">‚õ∂</button>
      <img src="${convertToEmbedImageUrl(pl.image_url)}" alt="${pl.title}">
      <h3>${pl.title}</h3>
      <p>${pl.description}</p>
      <button class="open-btn">Open</button>
    `;
    card.querySelector('.open-btn').addEventListener('click',e=>{
      e.stopPropagation();
      openPlaylistPage(pl.playlist_link);
    });
    card.querySelector('.share-btn').addEventListener('click',e=>{
      e.stopPropagation();
      sharePlaylist(pl);
    });
    card.querySelector('.archive-btn').addEventListener('click',e=>{
      e.stopPropagation();
      const img=convertToEmbedImageUrl(pl.image_url);
      openImageFullscreen(img);
    });
    playlistContainer.appendChild(card);
  });

  // Auto‚Äëopen ID‚ÄØ1 on first load
  if (autoOpenPlaylistId1){
    const p=allPlaylists.find(pl=>String(pl.id)==='1');
    if (p) openPlaylistPage(p.playlist_link);
    autoOpenPlaylistId1=false;
  }
}

/* ---------- Player Logic ---------- */
function openPlaylistPage(link){
  playlistContainer.style.display='none';
  playerPage.style.display='block';
  modeContainer.style.display='block';
  playlistLoadedReady = false;
  loadPlaylist(link);
}
backBtn.addEventListener('click',()=>{
  playerPage.style.display='none';
  playlistContainer.style.display='block';
  modeContainer.style.display='none';
  playerContainer.innerHTML='';
  widget=null;
  playlistLoadedReady=false;
});
function loadPlaylist(link){
  playerContainer.innerHTML=`
    <iframe id="scPlayer" width="100%" height="450" scrolling="no" frameborder="no"
            allow="autoplay"
            src="https://w.soundcloud.com/player/?url=${encodeURIComponent(link)}&auto_play=true&continuous_play=true">
    </iframe>`;
  const iframe=document.getElementById('scPlayer');
  widget=SC.Widget(iframe);

  widget.bind(SC.Widget.Events.READY,()=>{
    widget.getSounds(sounds=>{
      setTimeout(()=>{
        if (sounds && Array.isArray(sounds)){
          currentPlaylist = sounds;
          playlistLoadedReady = true;
          console.log('Track structure:', sounds[0]||'');
          currentIndex = (playMode==='order') ? 0 : Math.floor(Math.random()*sounds.length);
          playTrack(currentIndex);
        }else{
          showToast('Failed to load playlist tracks');
          currentPlaylist=[];
        }
      },300);
    });
    widget.bind(SC.Widget.Events.PLAY,()=>{
      widget.getCurrentSound(cur=>{ if(cur) console.log('Current song:',cur); });
    });
  });

  widget.bind(SC.Widget.Events.FINISH,()=>{
    if(!currentPlaylist.length) return;

    let nextIdx;

    if(playMode==='repeat'){
      nextIdx = currentIndex;
    }
    else if(playMode==='random'){
      nextIdx = Math.floor(Math.random()*currentPlaylist.length);
    }
    else{
      nextIdx = (currentIndex+1)%currentPlaylist.length;
    }

    currentIndex = nextIdx;

    widget.skip(currentIndex);

    if(userInteracted){
      setTimeout(()=>{
        widget.play();
      },300);
    }
  });
}
function playTrack(idx){
  currentIndex = idx;

  widget.skip(currentIndex);

  if(userInteracted){
    setTimeout(()=>{
      widget.play();
    },300);
  }
}
nextBtn.addEventListener('click',()=>{ if(!currentPlaylist.length) return;
  let nextIdx;
  if(playMode==='repeat') nextIdx = currentIndex;
  else if(playMode==='random') nextIdx = Math.floor(Math.random()*currentPlaylist.length);
  else nextIdx = (currentIndex+1)%currentPlaylist.length;
  
  playTrack(nextIdx);
});
prevBtn.addEventListener('click',()=>{ if(!currentPlaylist.length) return;
  let nextIdx;
  if(playMode==='repeat') nextIdx = currentIndex;
  else if(playMode==='random') nextIdx = Math.floor(Math.random()*currentPlaylist.length);
  else nextIdx = (currentIndex-1+currentPlaylist.length)%currentPlaylist.length;
  
  playTrack(nextIdx);
});

/* ---------- URL handling (shared link) ---------- */
function initFromURL(){
  const p=new URLSearchParams(window.location.search);
  const pid=p.get('playlist_id');
  if(pid){
    const pl=allPlaylists.find(o=>String(o.id)===pid);
    if(pl) openPlaylistPage(pl.playlist_link);
    return true;
  }
  return false;
}

/* ---------- Feedback Modal ---------- */
feedbackModal.addEventListener('click',()=>{
  feedbackModal.style.display='flex';
  let remaining=5;
  countdownElm.textContent=remaining;
  const int=setInterval(()=>{
    remaining--;
    if(remaining>0) countdownElm.textContent=remaining;
    else{
      clearInterval(int);
      feedbackModal.style.display='none';
      window.location.href='https://github.com/OpenThoughtVoice/OpenThoughtVoice/discussions/5';
    }
  },1000);
});

/* ---------- Mode Buttons ---------- */
randomModeBtn.addEventListener('click',()=>setPlayMode('random'));
orderModeBtn.addEventListener('click',()=>setPlayMode('order'));
repeatModeBtn.addEventListener('click',()=>setPlayMode('repeat'));
setPlayMode(playMode);

/* ---------- Home Button ---------- */
homeButton.addEventListener('click',()=>{
  window.location.href='https://yan-shun-081.github.io/yan-1-website.com/';
});

/* ---------- Fullscreen Image ---------- */
function openImageFullscreen(url){
  fullscreenImage.src=url;
  fullscreenContainer.style.display='flex';
  document.body.style.overflow='hidden';
  if (fullscreenContainer.requestFullscreen) fullscreenContainer.requestFullscreen();
  else if (fullscreenContainer.mozRequestFullScreen) fullscreenContainer.mozRequestFullScreen();
  else if (fullscreenContainer.webkitRequestFullscreen) fullscreenContainer.webkitRequestFullscreen();
  else if (fullscreenContainer.msRequestFullscreen) fullscreenContainer.msRequestFullscreen();
}
closeFullscreen.addEventListener('click',()=>{
  if (document.exitFullscreen) document.exitFullscreen();
  else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
  else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
  else if (document.msExitFullscreen) document.msExitFullscreen();
  fullscreenContainer.style.display='none';
  document.body.style.overflow='';
});
document.addEventListener('keydown',e=>{
  if(e.key==='Escape' && fullscreenContainer.style.display==='flex') closeFullscreen.click();
});

/* ---------- Global Search Listeners ---------- */
searchButton.addEventListener('click',performSearch);
backButton.addEventListener('click',resetSearch);
searchInput.addEventListener('keyup',e=>{ if(e.key==='Enter') performSearch(); });

/* ---------- Button Event Listeners ---------- */
allSongsBtn.addEventListener('click',()=>{ window.location.href='page1.html'; });
dontClickBtn.addEventListener('click', () => {
  window.open('https://soundcloud.com/yan-shun-335725597/sets/all-songs?si=64315d78a42a48e3b2e64f0710f759f0&utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing', '_blank');
});

/* ---------- Data Load ---------- */
fetch('data.json')
  .then(r=>r.json())
  .then(data=>{
    allPlaylists=data;
    filteredPlaylists=[...allPlaylists];
    const hasUrl=initFromURL();
    if(!hasUrl) autoOpenPlaylistId1=true;
    renderPlaylists();
  })
  .catch(err=>{
    console.error('Failed to load data.json',err);
    playlistContainer.innerHTML="<p style='color:red;'>Failed to load playlists.</p>";
  });
</script>
</body>
</html>
